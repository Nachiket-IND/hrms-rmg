<div class="app-container">
  <!-- Role-based Sidebar -->
  <ng-container [ngSwitch]="userRole">
    <app-sidebar *ngSwitchCase="'ADMIN'"></app-sidebar>
    <app-hr-sidebar *ngSwitchCase="'HR'"></app-hr-sidebar>
    <app-manager-sidebar *ngSwitchCase="'MANAGER'"></app-manager-sidebar>
    <app-finance-sidebar *ngSwitchCase="'FINANCE'"></app-finance-sidebar>
    <app-employee-sidebar *ngSwitchCase="'EMPLOYEE'"></app-employee-sidebar>
  </ng-container>

  <!-- Main Content -->
  <div class="main-content">
    <!-- <p-toast></p-toast> -->

    <!-- Back Button -->
    <div class="top-button-wrapper">
      <button class="action-button cancel" (click)="goBack()">← Back</button>
    </div>

    <div class="form-container">
      <h2 class="main-heading">Payroll Management</h2>

      <form [formGroup]="form" novalidate>
        <!-- Employee Selector -->
        <div class="form-group" *ngIf="isHrOrAdmin">
          <label>Select Employee:</label>
          <select class="form-control" formControlName="employeeId">
            <option value="" disabled>Select Employee</option>
            <option *ngFor="let emp of allEmployees" [value]="emp.empId">
              {{ emp.firstName }} {{ emp.lastName }} ({{ emp.employeeCode }})
            </option>
          </select>
          <div *ngIf="form.controls['employeeId'].touched && form.controls['employeeId'].invalid" class="text-danger mt-1">
            Employee selection is required.
          </div>
        </div>

        <!-- For normal employees -->
        <div class="form-group" *ngIf="!isHrOrAdmin">
          <label>Employee:</label>
          <input class="form-control" [value]="currentEmployeeName" disabled />
        </div>

        <div class="row mt-2">
          <!-- Month Selector -->
          <div class="col-md-6 form-group">
            <label>Month:</label>
            <select class="form-control" formControlName="month">
              <option value="" disabled>Select Month</option>
              <option *ngFor="let m of months" [value]="m.value">{{ m.name }}</option>
            </select>
            <div *ngIf="form.controls['month'].touched && form.controls['month'].invalid" class="text-danger mt-1">
              Month is required.
            </div>
          </div>

          <!-- Year Selector -->
          <div class="col-md-6 form-group">
            <label>Year:</label>
            <select class="form-control" formControlName="year">
              <option value="" disabled>Select Year</option>
              <option *ngFor="let y of years" [value]="y">{{ y }}</option>
            </select>
            <div *ngIf="form.controls['year'].touched && form.controls['year'].invalid" class="text-danger mt-1">
              Year is required.
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions mt-3">
          <button *ngIf="isHrOrAdmin" type="button" class="action-button" [disabled]="form.invalid" (click)="generate()">
            Generate Payroll
          </button>
          <button type="button" class="action-button cancel" [disabled]="form.invalid || !isFormReady" (click)="viewPayroll()">
            View Payroll
          </button>
          <button type="button" class="action-button success" [disabled]="form.invalid || !isFormReady" (click)="downloadPayslip()">
            Download Payslip
          </button>
        </div>
      </form>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="text-danger mt-2">{{ errorMessage }}</div>

      <!-- Payroll Details -->
      <div *ngIf="payroll" class="card payroll-card mt-4 p-3 shadow">
        <h4 class="text-primary fw-bold text-center mb-3">Payroll Details</h4>
        <ul class="list-group">
          <li class="list-group-item"><strong>Employee ID:</strong> {{ payroll.employee?.empId }}</li>
          <li class="list-group-item"><strong>Month:</strong> {{ payroll.month }}</li>
          <li class="list-group-item"><strong>Year:</strong> {{ payroll.year }}</li>
          <li class="list-group-item"><strong>Net Salary:</strong> ₹{{ payroll.netSalary }}</li>
          <li class="list-group-item"><strong>Total Earnings:</strong> ₹{{ payroll.totalEarnings }}</li>
          <li class="list-group-item"><strong>Total Deductions:</strong> ₹{{ payroll.totalDeductions }}</li>
          <li class="list-group-item"><strong>Payment Status:</strong> {{ payroll.paymentStatus }}</li>
          <li class="list-group-item"><strong>Present Days:</strong> {{ payroll.presentDays }}</li>
          <li class="list-group-item"><strong>Paid Leave Days:</strong> {{ payroll.paidLeaveDays }}</li>
          <li class="list-group-item"><strong>Working Days:</strong> {{ payroll.workingDays }}</li>
          <li class="list-group-item"><strong>Payable Days:</strong> {{ payroll.payableDays }}</li>
        </ul>
      </div>
    </div>
  </div>
</div>
