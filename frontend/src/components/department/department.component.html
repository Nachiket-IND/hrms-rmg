<div style="display: flex;">

  <!-- Role-based Sidebar -->
  <ng-container [ngSwitch]="userRole">
    <app-sidebar *ngSwitchCase="'ADMIN'"></app-sidebar>
    <app-hr-sidebar *ngSwitchCase="'HR'"></app-hr-sidebar>
    <app-manager-sidebar *ngSwitchCase="'MANAGER'"></app-manager-sidebar>
    <app-finance-sidebar *ngSwitchCase="'FINANCE'"></app-finance-sidebar>
    <app-employee-sidebar *ngSwitchCase="'EMPLOYEE'"></app-employee-sidebar>
  </ng-container>

  <!-- Main Content -->
  <div style="flex: 1; padding: 15px;">
    <p-toast></p-toast>

    <!-- Back Button -->

    <div class="button-row mb-3">
      <button class="action-button btn btn-secondary" (click)="goBack()">‚Üê Back</button>
    </div>

    <div class="department-form-container">

      <!-- Heading -->
      <h2 class="main-heading">{{ isEditMode ? 'Edit Department' : 'Department' }}</h2>

      <!-- Department Form -->
      <form *ngIf="canModify()" [formGroup]="departmentForm" (ngSubmit)="onSubmit()">
        <div class="form-sections">

          <!-- Department Details Section -->
          <div class="form-section">
            <h3>Create Department</h3>
            <div class="form-grid">

              <!-- Department Code -->
              <div class="form-group">
                <label>Department Code</label>
                <input formControlName="departmentCode" placeholder="Enter department code"
                  (keypress)="restrictDepartmentCode($event)" />
                <small class="text-danger"
                  *ngIf="submitted && departmentForm.get('departmentCode')?.hasError('required')">
                  Department Code is required.
                </small>
                <small class="text-danger"
                  *ngIf="submitted && departmentForm.get('departmentCode')?.hasError('maxlength')">
                  Maximum 8 characters allowed.
                </small>
              </div>

              <!-- Name -->
              <div class="form-group">
                <label>Name</label>
                <input formControlName="name" placeholder="Enter department name" (keypress)="restrictName($event)" />
                <small class="text-danger" *ngIf="submitted && departmentForm.get('name')?.hasError('required')">
                  Name is required.
                </small>
                <small class="text-danger" *ngIf="submitted && departmentForm.get('name')?.hasError('maxlength')">
                  Maximum 40 characters allowed.
                </small>
              </div>

              <!-- Description -->
              <div class="form-group">
                <label>Description</label>
                <input formControlName="description" placeholder="Enter department description"
                  (keypress)="restrictDescription($event)" />
                <small class="text-danger"
                  *ngIf="submitted && departmentForm.get('description')?.hasError('maxlength')">
                  Maximum 100 characters allowed.
                </small>
              </div>

              <!-- Location -->
              <div class="form-group">
                <label>Location</label>
                <input formControlName="location" placeholder="Enter department location"
                  (keypress)="restrictLocation($event)" />
                <small class="text-danger" *ngIf="submitted && departmentForm.get('location')?.hasError('maxlength')">
                  Maximum 10 characters allowed.
                </small>
              </div>

              <!-- Department Head -->
              <div class="form-group">
                <label>Department Head (Manager)</label>
                <select formControlName="departmentHead">
                  <option [ngValue]="null">-- No Department Head --</option>
                  <option *ngFor="let mgr of managers" [ngValue]="mgr">
                    {{ mgr.firstName }} {{ mgr.lastName }} ({{ mgr.employeeCode }})
                  </option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="form-actions">
          <button class="action-button" type="submit">
            {{ isEditMode ? 'Update' : 'Create' }}
          </button>
          <button class="action-button cancel" type="button" (click)="resetForm()">Clear</button>
        </div>
      </form>
      <hr />

      <!-- All Departments Table -->
      <div class="form-section">
        <h3>All Departments</h3>
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Code</th>
              <th>Name</th>
              <th>Location</th>
              <th>Head</th>
              <th *ngIf="canModify()">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let dept of departments">
              <td>{{ dept.departmentId }}</td>
              <td>{{ dept.departmentCode }}</td>
              <td>{{ dept.name }}</td>
              <td>{{ dept.location }}</td>
              <td>{{ getManagerNameById(dept.departmentHead?.empId) }}</td>
              <td *ngIf="canModify()">
                <button class="action-button" (click)="editDepartment(dept)">Edit</button>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Admin Only: All Users -->
        <div *ngIf="authService.isAdmin()">

          <hr />
          <h3 class="section-heading">All Users</h3>
          <table class="table">
            <thead>
              <tr>
                <th>User ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users">
                <td>{{ user.userID }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role }}</td>
                <td>{{ user.status }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>